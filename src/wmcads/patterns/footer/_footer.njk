{% macro wmcadsFooter(params) %}
{% set appClass = " ds-footer--mobile-app" if params.app else "" %}
{% set columns = " ds-col-lg-1-2" if params.columns == 2 else " ds-col-lg-1-3" %}
{# Imports #}
{% from "wmcads/patterns/feedback-loop/_feedback-loop.njk" import wmcadsFeedbackLoop %}
{% from "wmcads/components/icon/_icon.njk" import wmcadsIcon %}


<footer>
  {% if params.feedback -%}
  <!-- Feedback loop -->
  {{
    wmcadsFeedbackLoop({
      id: 'fb-footer',
      metaFields: [
        {name: 'contentType', value: 'content'}, 
        {name: 'contentName', value: 'PageTitle'}, 
        {name: 'contentLastEditor', value: 'Editor name'}, 
        {name: 'serviceName', value: 'Transport for West Midlands Design system'}, 
        {name: 'contentLastUpdated', value: '2021-03-19T11:18:15.532Z'}
      ],
      formFields: [
        {
          type: 'textarea',
          name: 'contentWrongComment',
          labelText: 'What is wrong with this page?',
          placeholder: 'Text',
          required: true
        },
        {
          type: 'input',
          name: 'emailAddress',
          labelText: 'Email address (optional)',
          placeholder: 'Text'
        },
        {
          type: 'checkbox',
          name: 'consent',
          labelText: 'I consent to being contacted about the issue I am reporting (optional)'
        },
        {
          type: 'checkbox',
          name: 'privacy',
          labelHTML: 'I agree to <a href="#">WMCA’s Privacy Policy</a>',
          required: true
        }
      ]
    })
  }}
  <!-- End feedback loop -->
  {% endif -%}
  <div class="ds-footer{{appClass}} ds-footer--v2">
    <div class="ds-container ds-grid">
      {% if(params.columns == 3) %}
      <div class="ds-col-1 {{columns}} ds-footer__updates-col">  
        <h3 class="ds-footer__heading">Stay up to date</h3>
        <p>Don’t miss out on vital information, subscribe today and be in the know at all times.</p>
        <a href="#" class="ds-btn ds-footer__btn ds-footer__btn--block">Sign up to updates</a>
      </div>
      {% endif %}
      {# loop through footer menus and get items #}
      {% if(params.menu1) %}
      {% set menu1Name = params.menu1.name | replace(r/[^\w\ ]/gi, '') | replace(' ', '-') | lower %}
        <div class="ds-col-1 {{columns}}">
          <h3 class="ds-footer__heading ds-collapse-heading" aria-controls="footer-menu-{{menu2Name}}" aria-expanded="true">
            {{params.menu1.name}}
            <button class="ds-footer__collapse-button">
              {{wmcadsIcon({class: 'ds-collapse-heading__indicator', icon: 'general-chevron-right'}) | trim}}
            </button>
          </h3>
          <ul class="ds-footer__menu ds-collapse-panel" id="footer-menu-{{menu2Name}}">
          {% for menuItem in params.menu1.menuItems-%}
            <li><a class="ds-footer__link" href="#">{{menuItem.name}}</a></li>
          {% endfor -%}
          </ul>
        </div>
      {% endif %}
      {% if(params.menu2) %}
      {% set menu2Name = params.menu2.name | replace(r/[^\w\ ]/gi, '') | replace(' ', '-') | lower %}
        <div class="ds-col-1 {{columns}}">
          <h3 class="ds-footer__heading ds-collapse-heading" aria-controls="footer-menu-{{menu2Name}}" aria-expanded="true">
            {{params.menu2.name}}
            <button class="ds-footer__collapse-button">
              {{wmcadsIcon({class: 'ds-collapse-heading__indicator', icon: 'general-chevron-right'}) | trim}}
            </button>
          </h3>
          <ul class="ds-footer__menu ds-collapse-panel" id="footer-menu-{{menu2Name}}">
          {% for menuItem in params.menu2.menuItems-%}
            <li><a class="ds-footer__link" href="#">{{menuItem.name}}</a></li>
          {% endfor -%}
          </ul>
          <h3 class="ds-footer__heading">Social media</h3>
          <ul class="ds-footer__social-media">
            <li><a href="https://www.facebook.com/westmidlandsnetwork/" title="Facebook">{{wmcadsIcon({icon: 'social-facebook'}) | trim}}</a></li>
            <li><a href="https://twitter.com/WMNetwork" title="Twitter">{{wmcadsIcon({icon: 'social-x-social'}) | trim}}</a></li>
            <li><a href="https://www.instagram.com/wmnetwork/" title="Instagram">{{wmcadsIcon({icon: 'social-instagram'}) | trim}}</a></li>
            <li><a href="https://www.youtube.com/channel/UCadbymPF89E81NQazkfBX0g" title="Youtube">{{wmcadsIcon({icon: 'social-youtube'}) | trim}}</a></li>
            <li><a href="https://www.linkedin.com/company/westmidsca" title="Linkedin">{{wmcadsIcon({icon: 'social-linkedin'}) | trim}}</a></li>
          </ul>
        </div>
      {% endif %}
      </div>
      <div class="ds-container">
        <div class="ds-footer__bottom ds-grid">
          <div class="ds-col-1 ds-col-md-1-2">
            <p class="ds-footer__copyright">&copy; West Midlands Combined Authority {{currentYear}}</p>
          </div>
          {% if params.bottomMenu -%}
          <div class="ds-col-1 ds-col-md-1-2">
            <ul class="ds-footer__bottom-menu">
              {# loop through bottom menu items #}
              {% for bottomMenuItem in params.bottomMenu -%}
              {% set bottomMenuLink = bottomMenuItem.link if bottomMenuItem.link else "" -%}
              <li><a class="ds-footer__link" href="{{bottomMenuItem.link}}">{{bottomMenuItem.name}}</a></li>
              {% endfor -%}
            </ul>
          </div>
          {% endif -%}
        </div>
      </div>
  </div>
</footer>

{% endmacro %}